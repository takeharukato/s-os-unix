TODO list

楯岡さんTODO

・DOS 部分のライセンスのクリア
・リアルタイム入力の改良
・BYTE,char,unsigned char 関係のコードの整理
・もっと綺麗なキーカスタマイズ
・拡張セットの機能の導入
・仮想画面管理部と実画面制御部の分離

(*) DOS 部分のライセンスのクリアについては, PDS宣言があるので問題は無し
加藤TODO
* DOSへの依存の排除
* 垂直同期の時間間隔の計測
* クロックティックに応じてCPUの命令を処理

[Console Command Processor]
* CCPを独立化
* マウントコマンドにイメージファイル種別を指定可能にする
* マウントコマンドにファイルシステム種別を指定可能にする
* マウントコマンドにリードオンリーマウントを指定可能にする

[エミュレーション環境]

* テープデバイスの共通化
  - テープデバイスドライバ部作成
  - ホストファイルシステムドライバ(QD)を作成
  - Sをホストドライブにすべきか検討
* trap.cのテープ関連処理をテープデバイス処理部に移動
  sos_trdd, sos_rdi, sos_wri, sos_twrd, sos_tdir, の実処理をtape.cに
  移動し, 'T', 'S', 'Q'を区別可能にする
* mztへの対応
* D88フォーマット対応

[fs]
* swordのエラーコードを引数で返すようにし, 内部エラーと区別がつくようにする
* read/write/seekでヘッダを読み飛ばす処理が必要
  ヘッダの書込みはwopen時(open flagsがwriteの場合にのみfdのfibの内容に従って実施)
* ファイルシステム共通部(fs-vfs)作成
* ファイルシステムマウント処理作成
* fatpos, dirpsをスーパブロック情報から取得するように修正
* WA_DIRPS, WA_FATPOSの更新を見張って, スーパーブロックの
  fatpos, dirpsをスーパブロック情報を更新
  (やりすぎか, システムコールで更新するべき)
* マウントテーブルの導入によりcheck_file_existsが不要になるので削除

[fs済]
* set/resetの為にchmodオペレーションが必要[済]
* creatを要作成[済]
[storage]
* マウント処理でファイルシステムを指定できるようにする
* マウント処理でファイルシステムストレージ単位での書込み禁止を指定できるようにする
* fib_read/fib_writeは, シーケンシャルデバイスからの読み書きを使用すれば実現できるが
  テープの内部ポジションを知っている必要があるのでstorageオペレーションに入っている

[セキュリティ]
* strtokをstrtok_rに置換え

[移植性]
* memmove, memcpy, memset, memrchrのOS依存の排除
* stdint.hのOS依存の排除

DOS依存システムコール
1. HOT
2. WOPEN
3. WRD
4. RDD
5. DRDSB
6. DWTSB
7. DIR
8. ROPEN
9. SET
10. RESET
11. NAME
12. KILL
13. RDVSW
14. SDVSW
15. ERROR
16. P#fnam
17. devchk
18. tpchk

[1] RDD
    - RDD  234f
    - DEVCHK 2851
    - RDD1 236a
    - TRDD 290c
    - DSKCHK 2591
    - FATRED 26ff
    - DLOAD 25e3

    1. #DSKを読み込んでDEVCHKを呼ぶ
    2. DEVCHKがエラーならキャリーをセットして復帰
    3. DEVCHKした結果がテープデバイスならTRDDを呼び出し後復帰
    4. DIRNOとRETPOIを0に設定
    5. オープンされていなければ, File Not Openを返して, キャリーをセットして復帰
    6. オープンされていればデバイスをクローズ
    7. DSKCHKを呼び出して標準ディスクでなければ, Reserved Featureを返して復帰
    8. FATREDを呼び出してFATをFATPOSに読み込む
    9. DLOADを呼び出してFATの内容に従ってファイルの内容をDTADRに読み込む

* ディレクトリエントリレコードの先頭(dirps)とFATレコードの先頭をdirとfibの双方で
  持っている問題を解消[済]
  1. FATレコードは, ファイルの削除とディレクトリエントリの削除の双方で使うので, posに移動
     し, storage-ifによって得る[済]
  2. storage-ifにdirps, fatposを参照・更新するIFを追加する[済]
  3. DIR構造体のディレクトリエントリレコードの先頭(dirps)エントリを削除[済]
  4. fibディレクトリエントリは, 使用用途がないので削除[済]
* src/trap.cの以下をsos.hに移動[済]
  TRAP_FNAME_BUFSIZ, TRAP_FNAME_EXT_BUFSIZ, TRAP_FNAME_PRNT_BUFSIZ
* strrchrのOS依存の排除[済]
* strncasecmpのOS依存の排除[済]
* zedaでQ:のファイルを読めない原因の調査[済]